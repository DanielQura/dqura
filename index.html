<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Ù…Ø³Ø§Ø¹Ø¯ Ø¹Ø±Ø¨ Ø¯Ø±ÙˆÙ†Ø² Ø§Ù„Ø°ÙƒÙŠ</title><!-- SEO:Add a concise and relevant meta description --><meta name="description" content="Ù…Ø³Ø§Ø¹Ø¯ Ø¹Ø±Ø¨ Ø¯Ø±ÙˆÙ†Ø² Ø§Ù„Ø°ÙƒÙŠ ÙŠÙ‚Ø¯Ù… Ù„Ùƒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­ÙˆÙ„ Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø·Ø§Ø¦Ø±Ø§Øª Ø¨Ø¯ÙˆÙ† Ø·ÙŠØ§Ø± ÙÙŠ Ø§Ù„Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆÙŠØ¬ÙŠØ¨ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„ØªÙƒ Ø§Ù„Ø¹Ø§Ù…Ø© Ø­ÙˆÙ„ Ø§Ù„Ø¯Ø±ÙˆÙ†Ø²."><!-- Removed:Link to manifest.json as PWA features are not fully supported in this environment --><!-- Tailwind CSS CDN for utility-first styling --><script src="https://cdn.tailwindcss.com"></script><!-- Google Fonts:IBM Plex Sans Arabic for better readability in Arabic --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet"><style>:root{--bg-primary:#0e0e0f;--bg-secondary:#1a1a1b;--bg-tertiary:#2c2c2e;--text-primary:#e5e7eb;--text-secondary:#9ca3af;--border-color:#3a3a3c;--accent-color:#2dd4bf;--accent-text:#111827}
body.light-theme{--bg-primary:#f9fafb;--bg-secondary:#ffffff;--bg-tertiary:#f3f4f6;--text-primary:#1f2937;--text-secondary:#6b7280;--border-color:#e5e7eb;--accent-color:#0d9488;--accent-text:#ffffff}
body{font-family:'IBM Plex Sans Arabic',sans-serif;background-color:var(--bg-primary);color:var(--text-primary);transition:background-color 0.3s,color 0.3s}
#chat-messages::-webkit-scrollbar{width:0;height:0}
#chat-messages{-ms-overflow-style:none;scrollbar-width:none}.typing-indicator span{height:10px;width:10px;float:left;margin:0 1px;background-color:var(--text-secondary);display:block;border-radius:50%;opacity:0.4;animation:typing 1s infinite}.typing-indicator span:nth-child(2){animation-delay:0.2s}.typing-indicator span:nth-child(3){animation-delay:0.4s}
@keyframes typing{0%,100%{opacity:0.4;transform:translateY(0)}
50%{opacity:1;transform:translateY(-4px)}}.suggestion-btn{background-color:var(--bg-tertiary);border:1px solid var(--border-color);color:var(--text-primary);padding:8px 16px;border-radius:20px;font-size:14px;cursor:pointer;transition:all 0.2s ease-in-out}.suggestion-btn:hover{background-color:var(--border-color)}.bot-response-content h4{font-weight:600;margin-top:1rem;margin-bottom:0.5rem;color:var(--accent-color)}.bot-response-content ul{list-style-type:disc;padding-right:1.5rem;margin-bottom:1rem}.bot-response-content a{color:var(--accent-color);text-decoration:underline}.accent-bg{background-color:var(--accent-color);color:var(--accent-text)}.accent-bg-hover:hover{filter:brightness(1.1)}.info-card{background-color:var(--bg-secondary);border-radius:0.75rem;padding:1rem;margin-bottom:0.75rem;border:1px solid var(--border-color)}.disclaimer{border-right:4px solid #facc15;background-color:rgba(250,204,21,0.1);padding:1rem;border-radius:0.5rem;font-size:0.875rem}
@media(max-width:768px){h1{font-size:1.25rem}
header{flex-direction:row;align-items:center;justify-content:space-between;padding-left:0.75rem;padding-right:0.75rem}
header.flex-grow{text-align:right}
header.flex.items-center{gap:0.5rem}.nav-link-btn{padding:6px 10px;font-size:0.75rem}.theme-toggle-btn-mobile{padding:0.25rem}.arab-drones-text{display:inline}.arab-drones-icon{display:none}
@media(max-width:480px){.arab-drones-text{display:none}.arab-drones-icon{display:inline-block}.px-4.py-2.rounded-full{padding:0.5rem 0.75rem}}}</style><script data-cfasync="false" nonce="d8dd967e-337c-4dfe-8f62-0558da14d150">try{(function(w,d){!function(fv,fw,fx,fy){if(fv.zaraz)console.error("zaraz is loaded twice");else{fv[fx]=fv[fx]||{};fv[fx].executed=[];fv.zaraz={deferred:[],listeners:[]};fv.zaraz._v="5858";fv.zaraz._n="d8dd967e-337c-4dfe-8f62-0558da14d150";fv.zaraz.q=[];fv.zaraz._f=function(fz){return async function(){var fA=Array.prototype.slice.call(arguments);fv.zaraz.q.push({m:fz,a:fA})}};for(const fB of["track","set","debug"])fv.zaraz[fB]=fv.zaraz._f(fB);fv.zaraz.init=()=>{var fC=fw.getElementsByTagName(fy)[0],fD=fw.createElement(fy),fE=fw.getElementsByTagName("title")[0];fE&&(fv[fx].t=fw.getElementsByTagName("title")[0].text);fv[fx].x=Math.random();fv[fx].w=fv.screen.width;fv[fx].h=fv.screen.height;fv[fx].j=fv.innerHeight;fv[fx].e=fv.innerWidth;fv[fx].l=fv.location.href;fv[fx].r=fw.referrer;fv[fx].k=fv.screen.colorDepth;fv[fx].n=fw.characterSet;fv[fx].o=(new Date).getTimezoneOffset();if(fv.dataLayer)for(const fF of Object.entries(Object.entries(dataLayer).reduce(((fG,fH)=>({...fG[1],...fH[1]})),{})))zaraz.set(fF[0],fF[1],{scope:"page"});fv[fx].q=[];for(;fv.zaraz.q.length;){const fI=fv.zaraz.q.shift();fv[fx].q.push(fI)}fD.defer=!0;for(const fJ of[localStorage,sessionStorage])Object.keys(fJ||{}).filter((fL=>fL.startsWith("_zaraz_"))).forEach((fK=>{try{fv[fx]["z_"+fK.slice(7)]=JSON.parse(fJ.getItem(fK))}catch{fv[fx]["z_"+fK.slice(7)]=fJ.getItem(fK)}}));fD.referrerPolicy="origin";fD.src="/cdn-cgi/zaraz/s.js?z="+btoa(encodeURIComponent(JSON.stringify(fv[fx])));fC.parentNode.insertBefore(fD,fC)};["complete","interactive"].includes(fw.readyState)?zaraz.init():fv.addEventListener("DOMContentLoaded",zaraz.init)}}(w,d,"zarazData","script");window.zaraz._p=async eC=>new Promise((eD=>{if(eC){eC.e&&eC.e.forEach((eE=>{try{const eF=d.querySelector("script[nonce]"),eG=eF?.nonce||eF?.getAttribute("nonce"),eH=d.createElement("script");eG&&(eH.nonce=eG);eH.innerHTML=eE;eH.onload=()=>{d.head.removeChild(eH)};d.head.appendChild(eH)}catch(eI){console.error(`Error executing script: ${eE}\n`,eI)}}));Promise.allSettled((eC.f||[]).map((eJ=>fetch(eJ[0],eJ[1]))))}eD()}));zaraz._p({"e":["(function(w,d){})(window,document)"]})})(window,document)}catch(e){throw fetch("/cdn-cgi/zaraz/t"),e};</script></head><body class="antialiased"><div id="chat-container" class="flex flex-col h-screen"><!-- Header Section --><header style="background-color: var(--bg-secondary); border-bottom: 1px solid var(--border-color);" class="text-white p-4 shadow-md z-10 flex justify-between items-center"><!-- Right side(RTL:Right side)-Title --><div class="flex-grow text-right"><h1 class="text-xl md:text-2xl font-semibold" style="color: var(--text-primary);">Ù…Ø³Ø§Ø¹Ø¯ Ø¹Ø±Ø¨ Ø¯Ø±ÙˆÙ†Ø² Ø§Ù„Ø°ÙƒÙŠ âœ¨</h1></div><!-- Left side(RTL:Left side)-Navigation Links and Theme Toggle --><div class="flex items-center gap-4"><!-- Ø¹Ø±Ø¨ Ø¯Ø±ÙˆÙ†Ø² button with accent color and globe icon --><a href="https://arabdrones.com/" target="_blank" rel="noopener noreferrer"
class="nav-link-btn px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 flex items-center gap-1"
style="background-color: var(--accent-color); color: var(--accent-text); white-space: nowrap; border: none;"><span class="arab-drones-text">Ø¹Ø±Ø¨ Ø¯Ø±ÙˆÙ†Ø²</span><!-- Globe SVG Icon --><svg class="arab-drones-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 512 512" fill="currentColor"><path d="M352 256c0 22.2-1.2 43.6-3.3 64l-185.3 0c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64l185.3 0c2.2 20.4 3.3 41.8 3.3 64zm28.8-64l123.1 0c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64l-123.1 0c2.1-20.6 3.2-42 3.2-64s-1.1-43.4-3.2-64zm112.6-32l-116.7 0c-10-63.9-29.8-117.4-55.3-151.6c78.3 20.7 142 77.5 171.9 151.6zm-149.1 0l-176.6 0c6.1-36.4 15.5-68.6 27-94.7c10.5-23.6 22.2-40.7 33.5-51.5C239.4 3.2 248.7 0 256 0s16.6 3.2 27.8 13.8c11.3 10.8 23 27.9 33.5 51.5c11.6 26 20.9 58.2 27 94.7zm-209 0L18.6 160C48.6 85.9 112.2 29.1 190.6 8.4C165.1 42.6 145.3 96.1 135.3 160zM8.1 192l123.1 0c-2.1 20.6-3.2 42-3.2 64s1.1 43.4 3.2 64L8.1 320C2.8 299.5 0 278.1 0 256s2.8-43.5 8.1-64zM194.7 446.6c-11.6-26-20.9-58.2-27-94.6l176.6 0c-6.1 36.4-15.5 68.6-27 94.6c-10.5 23.6-22.2 40.7-33.5 51.5C272.6 508.8 263.3 512 256 512s-16.6-3.2-27.8-13.8c-11.3-10.8-23-27.9-33.5-51.5zM135.3 352c10 63.9 29.8 117.4 55.3 151.6C112.2 482.9 48.6 426.1 18.6 352l116.7 0zm358.1 0c-30 74.1-93.6 130.9-171.9 151.6c25.5-34.2 45.2-87.7 55.3-151.6l116.7 0z"/></svg></a><!-- Theme Toggle Button with SVG Icons --><button id="theme-toggle-btn" class="p-1 theme-toggle-btn-mobile" style="color: var(--text-secondary);" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¸Ù‡Ø±"><svg id="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg><svg id="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></button></div></header><!-- Main chat messages display area --><main id="chat-messages" class="flex-1 w-full max-w-4xl mx-auto p-6 overflow-y-auto space-y-8"></main><!-- Footer section containing feature buttons and chat input --><div class="w-full max-w-4xl mx-auto p-4"><!-- Feature Buttons moved above the input field --><div id="feature-buttons-container" class="flex justify-center gap-2 pb-4 flex-wrap"><!-- Drone Laws Button --><button type="button" id="drone-laws-btn" class="suggestion-btn flex items-center gap-1" title="âš–ï¸ Ø®Ø¨ÙŠØ± Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø¯Ø±ÙˆÙ†Ø²"><span>Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø¯Ø±ÙˆÙ†Ø²</span></button><!-- New Suggestions Button --><button type="button" id="suggestions-btn" class="suggestion-btn flex items-center gap-1" title="âœ¨ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©"><span>Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</span></button></div><div id="quick-actions-container" class="pb-2"></div><div id="typing-indicator-container" class="px-6 pb-2 hidden"></div><form id="chat-form" class="flex items-center gap-2 rounded-full border p-2" style="background-color: var(--bg-secondary); border-color: var(--border-color);"><!-- Chat Input Field --><input type="text" id="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." autocomplete="off" class="flex-1 w-full px-4 py-2 bg-transparent focus:outline-none placeholder-gray-400" style="color: var(--text-primary);"><!-- Send Button --><button type="submit" class="accent-bg accent-bg-hover rounded-full p-2 transition-all duration-200"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button></form></div><!-- Developed By Footer<footer class="w-full text-center p-4 text-sm" style="background-color: var(--bg-primary); color: var(--text-secondary);">Ø£Ø­Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¹Ø±Ø¨ Ø¯Ø±ÙˆÙ†Ø²|Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ù€ Gemini|Ù‚Ø¨Ù„ Ù…Ø§ ØªØ¹ØªÙ…Ø¯ Ø¯ÙˆØ± ÙˆØªØ§ÙƒØ¯ ai Ø¨Ù‡Ø¨Ø¯ Ù…Ø±Ø§Øª</footer>--></div><script>document.addEventListener('DOMContentLoaded',()=>{const chatForm=document.getElementById('chat-form');const chatInput=document.getElementById('chat-input');const chatMessages=document.getElementById('chat-messages');const quickActionsContainer=document.getElementById('quick-actions-container');const themeToggleBtn=document.getElementById('theme-toggle-btn');const droneLawsBtn=document.getElementById('drone-laws-btn');const suggestionsBtn=document.getElementById('suggestions-btn');let chatHistory=[];let messageIdCounter=0;let isSuggesting=!1;let activeFlow=null;const apiKey="AIzaSyAYhira7vwa47RxXxLJXKcEMDwpccYK0qc";const getApiUrl=()=>`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;const questionsSchema={type:"OBJECT",properties:{questions:{type:"ARRAY",items:{type:"STRING"}}},required:["questions"]};const responseSchema={type:"OBJECT",properties:{summary:{type:"STRING"},points:{type:"ARRAY",items:{type:"STRING"}},sources:{type:"ARRAY",items:{type:"OBJECT",properties:{title:{type:"STRING"},url:{type:"STRING"}}}}},required:["summary","points"]};const lawsSchema={type:"OBJECT",properties:{registration:{type:"STRING"},noFlyZones:{type:"ARRAY",items:{type:"STRING"}},generalRules:{type:"ARRAY",items:{type:"STRING"}},disclaimer:{type:"STRING"}},required:["registration","noFlyZones","generalRules","disclaimer"]};function scrollToBottom(){chatMessages.scrollTop=chatMessages.scrollHeight}
function showTypingIndicator(){document.getElementById('typing-indicator-container').innerHTML=`<div class="flex items-start gap-3 justify-start"><div class="w-10 h-10 rounded-full flex items-center justify-center text-xl flex-shrink-0 border" style="background-color: var(--bg-secondary); border-color: var(--border-color);">âœ¨</div><div class="p-4 rounded-lg rounded-tl-none" style="background-color: var(--bg-secondary);"><div class="typing-indicator"><span></span><span></span><span></span></div></div></div>`;document.getElementById('typing-indicator-container').classList.remove('hidden');scrollToBottom()}
const hideTypingIndicator=()=>{document.getElementById('typing-indicator-container').classList.add('hidden')};function displaySuggestionLoader(container){container.innerHTML=`<div class="flex justify-center p-2"><div class="typing-indicator"><span></span><span></span><span></span></div></div>`;scrollToBottom()}
window.displaySuggestionButtons=function(container,questions){container.innerHTML='';const wrapper=document.createElement('div');wrapper.className=`flex gap-2 p-2 justify-center flex-wrap`;if(Array.isArray(questions)){questions.forEach(q=>{const button=document.createElement('button');button.textContent=q;button.className='suggestion-btn';button.onclick=()=>{chatInput.value=q;handleFormSubmit(new Event('submit',{bubbles:!0}))};wrapper.appendChild(button)})}
container.appendChild(wrapper);scrollToBottom()}
window.displayQuickActionOptions=function(options,handler){const wrapper=document.createElement('div');wrapper.className=`flex gap-2 p-2 justify-center flex-wrap`;options.forEach(q=>{const button=document.createElement('button');button.textContent=q;button.className='suggestion-btn';button.onclick=()=>handler(q);wrapper.appendChild(button)});quickActionsContainer.innerHTML='';quickActionsContainer.appendChild(wrapper);scrollToBottom()}
function toggleTheme(){document.body.classList.toggle('light-theme');const theme=document.body.classList.contains('light-theme')?'light':'dark';localStorage.setItem('arabDronesTheme',theme);updateThemeIcons(theme)}
function loadTheme(){const savedTheme=localStorage.getItem('arabDronesTheme')||'dark';if(savedTheme==='light'){document.body.classList.add('light-theme')}
updateThemeIcons(savedTheme)}
function updateThemeIcons(theme){document.getElementById('theme-icon-sun').classList.toggle('hidden',theme==='dark');document.getElementById('theme-icon-moon').classList.toggle('hidden',theme==='light')}
async function handleFormSubmit(e){e.preventDefault();const messageText=chatInput.value.trim();if(activeFlow==='laws'){handleLawsChoice(messageText);return}
if(activeFlow){appendMessage({text:messageText},'user');resetFlowState();await getBotResponse();return}
if(!messageText)return;quickActionsContainer.innerHTML='';appendMessage({text:messageText},'user');chatHistory.push({role:'user',parts:[{text:messageText}]});saveChatHistory();chatInput.value='';showTypingIndicator();await getBotResponse()}
function appendMessage(content,sender,options={}){messageIdCounter++;const{isInitial=!1,htmlContent=null}=options;const messageWrapper=document.createElement('div');let messageHtml='';if(sender==='user'){messageWrapper.className='flex items-start gap-3 justify-end';let textHtml=content.text?`<p>${content.text}</p>`:'';messageHtml=`<div class="accent-bg p-4 rounded-xl rounded-br-none max-w-lg shadow">${textHtml}</div><div class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg flex-shrink-0 border" style="background-color: var(--bg-tertiary); border-color: var(--border-color);">U</div>`}else{const formattedHtml=htmlContent?htmlContent:(typeof content==='string'?`<p>${content}</p>`:window.formatBotResponse(content));const followUpButton='';messageWrapper.className='flex flex-col items-start gap-2';messageHtml=`<div class="flex items-start gap-3 justify-start w-full"><div class="w-10 h-10 rounded-full flex items-center justify-center text-xl flex-shrink-0 border" style="background-color: var(--bg-secondary); border-color: var(--border-color);">âœ¨</div><div class="p-4 rounded-xl rounded-bl-none max-w-lg w-full bot-response-content" style="background-color: var(--bg-secondary);">${formattedHtml}</div></div>${followUpButton}`}
messageWrapper.innerHTML=messageHtml;chatMessages.appendChild(messageWrapper);scrollToBottom()}
function setFlowState(flowName,placeholderText,disableInput=!0){activeFlow=flowName;quickActionsContainer.innerHTML='';chatInput.disabled=disableInput;chatInput.placeholder=placeholderText}
function resetFlowState(){activeFlow=null;chatInput.disabled=!1;chatInput.placeholder='Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...'}
function startLawsFlow(){if(activeFlow)return;setFlowState('laws','Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¨Ù„Ø¯ (Ù…Ø«Ø§Ù„: Ø§Ù„Ø£Ø±Ø¯Ù†)',!1);appendMessage("âš–ï¸ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø®Ø¨ÙŠØ± Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø¯Ø±ÙˆÙ†Ø²! Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŒ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ø¨Ù„Ø¯ Ø§Ù„Ø°ÙŠ ØªÙˆØ¯ Ù…Ø¹Ø±ÙØ© Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø¯Ø±ÙˆÙ†Ø² ÙÙŠÙ‡ØŒ Ø£Ùˆ Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© Ø£Ø¯Ù†Ø§Ù‡.",'bot');window.displayQuickActionOptions(['ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©','ğŸ‡¦ğŸ‡ª Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª','ğŸ‡ªğŸ‡¬ Ù…ØµØ±','ğŸ‡¯ğŸ‡´ Ø§Ù„Ø£Ø±Ø¯Ù†'],handleLawsChoice)}
function handleLawsChoice(country){if(!country.trim()){appendMessage("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ø³Ù… Ø§Ù„Ø¨Ù„Ø¯ Ø§Ù„Ø°ÙŠ ØªÙˆØ¯ Ù…Ø¹Ø±ÙØ© Ù‚ÙˆØ§Ù†ÙŠÙ†Ù‡.",'bot');return}
appendMessage({text:country},'user');quickActionsContainer.innerHTML='';chatInput.placeholder='Ù„Ø­Ø¸Ø§ØªØŒ Ø£Ù‚ÙˆÙ… Ø¨Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ†...';chatInput.disabled=!0;showTypingIndicator();getDroneLaws(country.replace(/[\p{Extended_Pictographic}\s]/gu,''))}
async function getDroneLaws(country){const prompt=`Ø£Ù†Øª Ø®Ø¨ÙŠØ± ÙÙŠ Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø·Ø§Ø¦Ø±Ø§Øª Ø¨Ø¯ÙˆÙ† Ø·ÙŠØ§Ø±. Ù‚Ù… Ø¨ØªÙ„Ø®ÙŠØµ Ø£Ù‡Ù… Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø¯Ø±ÙˆÙ†Ø² ÙÙŠ "${country}" Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©. Ø±ÙƒØ² Ø¹Ù„Ù‰: 1. Ù…ØªØ·Ù„Ø¨Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø±ÙˆÙ†. 2. Ø£Ù‡Ù… Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø­Ø¸Ø± Ø§Ù„Ø¬ÙˆÙŠ. 3. Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø·ÙŠØ±Ø§Ù† (Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ØŒ Ø§Ù„Ù…Ø³Ø§ÙØ©ØŒ Ø§Ù„ØªÙˆÙ‚ÙŠØª). 4. Ù‚Ø¯Ù… Ø¥Ø®Ù„Ø§Ø¡ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ù…Ù‡Ù… ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©.`;const payload={contents:[{role:'user',parts:[{text:prompt}]}],generationConfig:{responseMimeType:"application/json",responseSchema:lawsSchema}};try{const response=await fetch(getApiUrl(),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(!response.ok){throw new Error(`API Error: ${response.status} - ${response.statusText}`)}
const result=await response.json();const laws=JSON.parse(result.candidates?.[0]?.content?.parts?.[0]?.text||'{}');if(!laws||!laws.registration||!laws.noFlyZones||!laws.generalRules||!laws.disclaimer){throw new Error("Invalid or incomplete laws data received from the model.")}
let htmlContent=`<h4>âš–ï¸ Ù…Ù„Ø®Øµ Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø¯Ø±ÙˆÙ†Ø² ÙÙŠ ${country}</h4>`;htmlContent+=`<div class="info-card"><h4>Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h4><p>${laws.registration}</p></div>`;htmlContent+=`<div class="info-card"><h4>Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø­Ø¸Ø± Ø§Ù„Ø¬ÙˆÙŠ</h4><ul>${laws.noFlyZones.map(r => `<li>-${r}</li>`).join('')}</ul></div>`;htmlContent+=`<div class="info-card"><h4>Ù‚ÙˆØ§Ø¹Ø¯ Ø¹Ø§Ù…Ø©</h4><ul>${laws.generalRules.map(r => `<li>-${r}</li>`).join('')}</ul></div>`;htmlContent+=`<div class="disclaimer">${laws.disclaimer}</div>`;hideTypingIndicator();appendMessage(null,'bot',{htmlContent})}catch(error){console.error("Error fetching laws:",error);hideTypingIndicator();appendMessage("Ø¹Ø°Ø±Ø§Ù‹ØŒ ÙˆØ§Ø¬Ù‡Øª Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù„Ø¯ Ø£Ùˆ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.",'bot')}finally{resetFlowState()}}
window.formatBotResponse=function(data){let html=`<p>${data.summary}</p>`;if(data.points&&data.points.length>0){html+=`<h4>Ù†Ù‚Ø§Ø· Ø±Ø¦ÙŠØ³ÙŠØ©</h4><ul>${data.points.map(p => `<li>${p}</li>`).join('')}</ul>`}
if(data.sources&&data.sources.length>0){html+=`<h4>Ù…ØµØ§Ø¯Ø±</h4><ul>${data.sources.map(s => `<li><a href="${s.url}" target="_blank" rel="noopener noreferrer">${s.title}</a></li>`).join('')}</ul>`}
return html}
async function getBotResponse(){const promptSuffix=` ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ±ÙƒÙŠØ² ÙÙŠ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø¹Ù„Ù‰ Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø§Ù„Ø¯Ø±ÙˆÙ†Ø² ÙÙ‚Ø·ØŒ Ù…Ø«Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§ØªÙ‡Ø§ØŒ Ø£Ù†ÙˆØ§Ø¹Ù‡Ø§ØŒ ØµÙŠØ§Ù†ØªÙ‡Ø§ØŒ ØªÙ‚Ù†ÙŠØ§ØªÙ‡Ø§ØŒ Ø£Ø®Ø¨Ø§Ø±Ù‡Ø§ØŒ Ø£Ùˆ Ø£ÙŠ Ø´ÙŠØ¡ Ø°ÙŠ ØµÙ„Ø© Ø¨Ø¹Ø§Ù„Ù… Ø§Ù„Ø¯Ø±ÙˆÙ†Ø². Ù„Ø§ ØªØªØ­Ø¯Ø« ÙÙŠ Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø¹Ø§Ù…Ø© Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¯Ø±ÙˆÙ†Ø².`;const fullChatHistory=chatHistory.map(msg=>({role:msg.role,parts:[{text:msg.role==='user'?msg.parts[0].text+promptSuffix:msg.parts[0].text}]}));const finalPayload={contents:fullChatHistory,generationConfig:{responseMimeType:"application/json",responseSchema:responseSchema}};try{const response=await fetch(getApiUrl(),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(finalPayload)});if(!response.ok){throw new Error(`API Error: ${response.status} - ${response.statusText}`)}
const result=await response.json();let botResponse={summary:"Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø©.",points:[]};if(result.candidates?.[0]?.content?.parts?.[0]?.text){try{botResponse=JSON.parse(result.candidates[0].content.parts[0].text);if(!botResponse.summary||!Array.isArray(botResponse.points)){throw new Error("Parsed bot response missing required fields.")}}catch(parseError){console.error("Error parsing bot response JSON:",parseError);botResponse.summary="Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ÙÙ‡Ù… Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.";botResponse.points=[];botResponse.sources=[]}}
chatHistory.push({role:'model',parts:[{text:JSON.stringify(botResponse)}]});saveChatHistory();hideTypingIndicator();appendMessage(botResponse,'bot')}catch(error){console.error("Error fetching or processing bot response:",error);hideTypingIndicator();appendMessage("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",'bot')}}
async function getSuggestions(prompt){if(isSuggesting)return["Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŒ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª..."];isSuggesting=!0;const payload={contents:[{role:'user',parts:[{text:prompt}]}],generationConfig:{responseMimeType:"application/json",responseSchema:questionsSchema}};try{const response=await fetch(getApiUrl(),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(!response.ok){throw new Error(`API Error: ${response.status} - ${response.statusText}`)}
const result=await response.json();const parsedResult=JSON.parse(result.candidates?.[0]?.content?.parts?.[0]?.text||'{}');return parsedResult.questions||[]}catch(error){console.error("Error fetching suggestions:",error);return["Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹."]}finally{isSuggesting=!1}}
async function getInitialSuggestions(){displaySuggestionLoader(quickActionsContainer);const prompt="Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„Ø¯Ø±ÙˆÙ†Ø². Ø§Ù‚ØªØ±Ø­ 3 Ø£Ø³Ø¦Ù„Ø© Ø¨Ø³ÙŠØ·Ø© Ø¬Ø¯Ø§Ù‹ ÙˆÙ…ÙˆØ¬Ø²Ø© (Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 7 ÙƒÙ„Ù…Ø§Øª) Ø­ÙˆÙ„ Ø§Ù„Ø¯Ø±ÙˆÙ†Ø² Ø£Ùˆ Ù‚ÙˆØ§Ù†ÙŠÙ†Ù‡Ø§ØŒ ÙƒÙ„ Ø³Ø¤Ø§Ù„ ÙŠØ¨Ø¯Ø£ Ø¨Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ù…Ù†Ø§Ø³Ø¨.";const questions=await getSuggestions(prompt);window.displaySuggestionButtons(quickActionsContainer,questions)}
window.getFollowUpSuggestions=async function(messageId){const container=document.getElementById(`follow-up-container-${messageId}`);if(!container)return;displaySuggestionLoader(container);const prompt=`Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„ØªØ§Ù„ÙŠ Ø§Ù„Ø°ÙŠ ÙŠØªØ±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø±ÙˆÙ†Ø²ØŒ Ø§Ù‚ØªØ±Ø­ 3 Ø£Ø³Ø¦Ù„Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø³ÙŠØ·Ø© Ø¬Ø¯Ø§Ù‹ ÙˆÙ…ÙˆØ¬Ø²Ø© (Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 7 ÙƒÙ„Ù…Ø§Øª) Ø°Ø§Øª ØµÙ„Ø©ØŒ ÙƒÙ„ Ø³Ø¤Ø§Ù„ ÙŠØ¨Ø¯Ø£ Ø¨Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ù…Ù†Ø§Ø³Ø¨.`;const questions=await getSuggestions(prompt);window.displaySuggestionButtons(container,questions)}
function saveChatHistory(){sessionStorage.setItem('arabDronesChatHistory',JSON.stringify(chatHistory))}
function loadChatHistory(){const savedHistory=sessionStorage.getItem('arabDronesChatHistory');if(savedHistory){chatHistory=JSON.parse(savedHistory);chatMessages.innerHTML='';chatHistory.forEach(item=>{const isInitialLoadMessage=chatHistory.indexOf(item)===0;if(item.role==='user'){appendMessage(item.parts[0],'user')}else if(item.role==='model'){try{appendMessage(JSON.parse(item.parts[0].text),'bot',{isInitial:isInitialLoadMessage})}catch(e){appendMessage(item.parts[0].text,'bot',{isInitial:isInitialLoadMessage})}}});scrollToBottom()}else{const initialMsg="Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø³Ø§Ø¹Ø¯ Ø¹Ø±Ø¨ Ø¯Ø±ÙˆÙ†Ø² Ø§Ù„Ø°ÙƒÙŠ. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ";appendMessage(initialMsg,'bot',{isInitial:!0});chatHistory.push({role:'model',parts:[{text:initialMsg}]});saveChatHistory();getInitialSuggestions()}}
loadTheme();loadChatHistory();chatForm.addEventListener('submit',handleFormSubmit);themeToggleBtn.addEventListener('click',toggleTheme);droneLawsBtn.addEventListener('click',startLawsFlow);suggestionsBtn.addEventListener('click',getInitialSuggestions)});</script></body></html>